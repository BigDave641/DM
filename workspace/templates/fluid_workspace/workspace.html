{% extends "fluid_workspace/base.html" %}
{% load static from staticfiles %}

{% block head_css %}
<style>
  .row-fluid #noMargin {
      margin-left:0;
  }

  .tool-line {
      position:fixed;
      text-align: center;
      top: 56px;
  }

  #grid {
      padding-top: 105px;
  }

  .modal-body .sc-RepoBrowser {
    height: 400px;
  }

  .atb-wrapper-container {
    width: 100%;
    height: 100%;

    padding: 10px;
  }

  /*.atb-wrapper-inner {
    height: auto;
  }*/

  .atb-wrapper-heading {
    display: none;
  }
</style>
{% endblock %}

{% block head_scripts %}
{% include "fluid_workspace/ui_scripts.html" %}
<script
   src="{% static 'js/dm/fluid_workspace.js' %}"
   type="text/javascript">
</script>
{% endblock %}

{% block header_buttons %}
  <li id="my_resources_button"><a href="#workingResourcesModal" role="button" data-toggle="modal">my resources</a></li>
  <li id="repositories_button"><a href="#repoBrowserModal" role="button" data-toggle="modal">repositories</a></li>
  <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
      layout
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li id="1x1_layout_button"><a href="#">1x1</a></li>
      <li id="1x2_layout_button"><a href="#">1x2</a></li>
      <li id="1x3_layout_button"><a href="#">1x3</a></li>
      <li id="2x2_layout_button"><a href="#">2x2</a></li>
      <li id="2x3_layout_button"><a href="#">2x3</a></li>
      <li id="3x3_layout_button"><a href="#">3x3</a></li>
      <li id="3x4_layout_button"><a href="#">3x4</a></li>
      <li id="4x4_layout_button"><a href="#">4x4</a></li>
    </ul>
  </li>
{% endblock %}

{% block page_content %}
<div>
  <div class="row-fluid" id="grid">

  </div>
</div>

    <!--Custom js that prepends divs & restructures grid.-->
    <script>

      var columns = "span6";
      var rows = 2;

      viewers = [];

      function setFirst(){
        var count = 0;

        $("#grid").children().each(function(){
          var inRow = 12 / parseInt(columns.substring(4));
          if(count % inRow === 0){
            $(this).attr("id","noMargin");
          }
            else $(this).removeAttr("id");
          count++;
        })
      }

      function setHeight(){
        var height = ($(window).height() - $("#selector").height()) / rows;
        $("#grid").children().each(function(){
          $(this).height(height);
        })
      }
      
      function setSpan(){
        $("#grid").children().attr('class', columns);
        setFirst();
        setHeight();
      }

      function resizeViewers() {
        goog.structs.forEach(viewers, function(viewer, i) {
          if (viewer.viewer && viewer.viewer.resize) {
            var div = $('#grid').children().get(i);
            $(div).find('.atb-wrapper-inner').height($(div).height());
            viewer.viewer.resize(jQuery(div).width(), jQuery(div).height());
          }
        });

        // jQuery(viewers).each(function(){
        //   if (jQuery.isFunction(this.autoResize)) {
        //     this.autoResize();
        //   }
        // })
      }

      setSpan();

      $("#1x1_layout_button").click(function(){
        columns = "span12";
        rows = 1;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#1x2_layout_button").click(function(){
        columns = "span6";
        rows = 1;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#1x3_layout_button").click(function(){
        columns = "span4";
        rows = 1;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#2x2_layout_button").click(function(){
        columns = "span6";
        rows = 2;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#2x3_layout_button").click(function(){
        columns = "span4";
        rows = 2;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#3x3_layout_button").click(function(){
        columns = "span4";
        rows = 3;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#3x4_layout_button").click(function(){
        columns = "span3";
        rows = 3;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $("#4x4_layout_button").click(function(){
        columns = "span3";
        rows = 4;
        windowScaler.scale(rows);
        setSpan();
        resizeViewers();
      })

      $(window).resize(function(){
        setSpan();
        });
      
    </script>



<!-- Modal -->
<div id="repoBrowserModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">Repositories</h3>
  </div>
  <div class="modal-body">

  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Done</button>
  </div>
</div>

<div id="workingResourcesModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">My Resources</h3>
  </div>
  <div class="modal-body">

  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Done</button>
  </div>
</div>

{% endblock %}

{% block init_scripts %}
<script type="text/javascript" >
  var staticUrl = "{{ STATIC_URL }}";
  var styleRoot = "{{ STATIC_URL }}css/";
  var wsURI = "{{ WEBSERVICE_URI }}";
  var mediawsURI = "{{ MEDIA_WEBSERVICE_URI }}";
  var wsSameOriginURI = "/"
  initWorkspace(wsURI, mediawsURI, wsSameOriginURI, "{{ user.username }}", 
                styleRoot);
</script>
{% endblock %}
